import { StorageUtil, isBrowser } from './util';
const cache = {};
function WebStorage(storage, key, expiredAt = 0, expiredUnit = 'd') {
    return (target, propertyName) => {
        key = key || propertyName;
        Object.defineProperty(target, propertyName, {
            get: () => {
                return StorageUtil.get(storage, key);
            },
            set: (value) => {
                if (!cache[key]) {
                    const storedValue = StorageUtil.get(storage, key);
                    if (storedValue === null) {
                        StorageUtil.set(storage, key, value, expiredAt, expiredUnit);
                    }
                    cache[key] = true;
                    return;
                }
                StorageUtil.set(storage, key, value, expiredAt, expiredUnit);
            },
            enumerable: true,
            configurable: true,
        });
    };
}
/**
 * `localStorage` Decorator
 *
 * @param [expiredAt=0] Expiration time, 0 means forever
 * @param [expiredUnit='t'] Expiration time unit (default: custom [unit: ms])
 */
export function LocalStorage(key, expiredAt = 0, expiredUnit = 't') {
    return WebStorage(isBrowser ? localStorage : null, key, expiredAt, expiredUnit);
}
/**
 * `sessionStorage` Decorator
 *
 * @param [expiredAt=0] Expiration time, 0 means forever
 * @param [expiredUnit='t'] Expiration time unit (default: custom [unit: ms])
 */
export function SessionStorage(key, expiredAt = 0, expiredUnit = 't') {
    return WebStorage(isBrowser ? sessionStorage : null, key, expiredAt, expiredUnit);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGVjb3JhdG9yLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vbGliL3NyYy9kZWNvcmF0b3IudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFlLFdBQVcsRUFBRSxTQUFTLEVBQUUsTUFBTSxRQUFRLENBQUM7QUFLN0QsTUFBTSxLQUFLLEdBQVcsRUFBRSxDQUFDO0FBRXpCLFNBQVMsVUFBVSxDQUNqQixPQUFnQixFQUNoQixHQUFXLEVBQ1gsWUFBb0IsQ0FBQyxFQUNyQixjQUEyQixHQUFHO0lBRTlCLE9BQU8sQ0FBQyxNQUFVLEVBQUUsWUFBb0IsRUFBUSxFQUFFO1FBQ2hELEdBQUcsR0FBRyxHQUFHLElBQUksWUFBWSxDQUFDO1FBQzFCLE1BQU0sQ0FBQyxjQUFjLENBQUMsTUFBTSxFQUFFLFlBQVksRUFBRTtZQUMxQyxHQUFHLEVBQUUsR0FBRyxFQUFFO2dCQUNSLE9BQU8sV0FBVyxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsR0FBYSxDQUFDLENBQUM7WUFDakQsQ0FBQztZQUNELEdBQUcsRUFBRSxDQUFDLEtBQVUsRUFBRSxFQUFFO2dCQUNsQixJQUFJLENBQUMsS0FBSyxDQUFDLEdBQWEsQ0FBQyxFQUFFO29CQUN6QixNQUFNLFdBQVcsR0FBRyxXQUFXLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxHQUFhLENBQUMsQ0FBQztvQkFDNUQsSUFBSSxXQUFXLEtBQUssSUFBSSxFQUFFO3dCQUN4QixXQUFXLENBQUMsR0FBRyxDQUNiLE9BQU8sRUFDUCxHQUFhLEVBQ2IsS0FBSyxFQUNMLFNBQVMsRUFDVCxXQUFXLENBQ1osQ0FBQztxQkFDSDtvQkFDRCxLQUFLLENBQUMsR0FBYSxDQUFDLEdBQUcsSUFBSSxDQUFDO29CQUM1QixPQUFPO2lCQUNSO2dCQUNELFdBQVcsQ0FBQyxHQUFHLENBQUMsT0FBTyxFQUFFLEdBQWEsRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFFLFdBQVcsQ0FBQyxDQUFDO1lBQ3pFLENBQUM7WUFDRCxVQUFVLEVBQUUsSUFBSTtZQUNoQixZQUFZLEVBQUUsSUFBSTtTQUNuQixDQUFDLENBQUM7SUFDTCxDQUFDLENBQUM7QUFDSixDQUFDO0FBRUQ7Ozs7O0dBS0c7QUFDSCxNQUFNLFVBQVUsWUFBWSxDQUMxQixHQUFZLEVBQ1osWUFBb0IsQ0FBQyxFQUNyQixjQUEyQixHQUFHO0lBRTlCLE9BQU8sVUFBVSxDQUNmLFNBQVMsQ0FBQyxDQUFDLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxJQUFJLEVBQy9CLEdBQUcsRUFDSCxTQUFTLEVBQ1QsV0FBVyxDQUNaLENBQUM7QUFDSixDQUFDO0FBRUQ7Ozs7O0dBS0c7QUFDSCxNQUFNLFVBQVUsY0FBYyxDQUM1QixHQUFZLEVBQ1osWUFBb0IsQ0FBQyxFQUNyQixjQUEyQixHQUFHO0lBRTlCLE9BQU8sVUFBVSxDQUNmLFNBQVMsQ0FBQyxDQUFDLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQyxJQUFJLEVBQ2pDLEdBQUcsRUFDSCxTQUFTLEVBQ1QsV0FBVyxDQUNaLENBQUM7QUFDSixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRXhwaXJlZFVuaXQsIFN0b3JhZ2VVdGlsLCBpc0Jyb3dzZXIgfSBmcm9tICcuL3V0aWwnO1xuXG5pbnRlcmZhY2UgSUNhY2hlIHtcbiAgW2tleTogc3RyaW5nXTogYm9vbGVhbjtcbn1cbmNvbnN0IGNhY2hlOiBJQ2FjaGUgPSB7fTtcblxuZnVuY3Rpb24gV2ViU3RvcmFnZShcbiAgc3RvcmFnZTogU3RvcmFnZSxcbiAga2V5OiBzdHJpbmcsXG4gIGV4cGlyZWRBdDogbnVtYmVyID0gMCxcbiAgZXhwaXJlZFVuaXQ6IEV4cGlyZWRVbml0ID0gJ2QnLFxuKTogKHRhcmdldDoge30sIHByb3BlcnR5TmFtZTogc3RyaW5nKSA9PiB2b2lkIHtcbiAgcmV0dXJuICh0YXJnZXQ6IHt9LCBwcm9wZXJ0eU5hbWU6IHN0cmluZyk6IHZvaWQgPT4ge1xuICAgIGtleSA9IGtleSB8fCBwcm9wZXJ0eU5hbWU7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgcHJvcGVydHlOYW1lLCB7XG4gICAgICBnZXQ6ICgpID0+IHtcbiAgICAgICAgcmV0dXJuIFN0b3JhZ2VVdGlsLmdldChzdG9yYWdlLCBrZXkgYXMgc3RyaW5nKTtcbiAgICAgIH0sXG4gICAgICBzZXQ6ICh2YWx1ZTogYW55KSA9PiB7XG4gICAgICAgIGlmICghY2FjaGVba2V5IGFzIHN0cmluZ10pIHtcbiAgICAgICAgICBjb25zdCBzdG9yZWRWYWx1ZSA9IFN0b3JhZ2VVdGlsLmdldChzdG9yYWdlLCBrZXkgYXMgc3RyaW5nKTtcbiAgICAgICAgICBpZiAoc3RvcmVkVmFsdWUgPT09IG51bGwpIHtcbiAgICAgICAgICAgIFN0b3JhZ2VVdGlsLnNldChcbiAgICAgICAgICAgICAgc3RvcmFnZSxcbiAgICAgICAgICAgICAga2V5IGFzIHN0cmluZyxcbiAgICAgICAgICAgICAgdmFsdWUsXG4gICAgICAgICAgICAgIGV4cGlyZWRBdCxcbiAgICAgICAgICAgICAgZXhwaXJlZFVuaXQsXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjYWNoZVtrZXkgYXMgc3RyaW5nXSA9IHRydWU7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIFN0b3JhZ2VVdGlsLnNldChzdG9yYWdlLCBrZXkgYXMgc3RyaW5nLCB2YWx1ZSwgZXhwaXJlZEF0LCBleHBpcmVkVW5pdCk7XG4gICAgICB9LFxuICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICB9KTtcbiAgfTtcbn1cblxuLyoqXG4gKiBgbG9jYWxTdG9yYWdlYCBEZWNvcmF0b3JcbiAqXG4gKiBAcGFyYW0gW2V4cGlyZWRBdD0wXSBFeHBpcmF0aW9uIHRpbWUsIDAgbWVhbnMgZm9yZXZlclxuICogQHBhcmFtIFtleHBpcmVkVW5pdD0ndCddIEV4cGlyYXRpb24gdGltZSB1bml0IChkZWZhdWx0OiBjdXN0b20gW3VuaXQ6IG1zXSlcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIExvY2FsU3RvcmFnZShcbiAga2V5Pzogc3RyaW5nLFxuICBleHBpcmVkQXQ6IG51bWJlciA9IDAsXG4gIGV4cGlyZWRVbml0OiBFeHBpcmVkVW5pdCA9ICd0Jyxcbik6ICh0YXJnZXQ6IHt9LCBwcm9wZXJ0eU5hbWU6IHN0cmluZykgPT4gdm9pZCB7XG4gIHJldHVybiBXZWJTdG9yYWdlKFxuICAgIGlzQnJvd3NlciA/IGxvY2FsU3RvcmFnZSA6IG51bGwsXG4gICAga2V5LFxuICAgIGV4cGlyZWRBdCxcbiAgICBleHBpcmVkVW5pdCxcbiAgKTtcbn1cblxuLyoqXG4gKiBgc2Vzc2lvblN0b3JhZ2VgIERlY29yYXRvclxuICpcbiAqIEBwYXJhbSBbZXhwaXJlZEF0PTBdIEV4cGlyYXRpb24gdGltZSwgMCBtZWFucyBmb3JldmVyXG4gKiBAcGFyYW0gW2V4cGlyZWRVbml0PSd0J10gRXhwaXJhdGlvbiB0aW1lIHVuaXQgKGRlZmF1bHQ6IGN1c3RvbSBbdW5pdDogbXNdKVxuICovXG5leHBvcnQgZnVuY3Rpb24gU2Vzc2lvblN0b3JhZ2UoXG4gIGtleT86IHN0cmluZyxcbiAgZXhwaXJlZEF0OiBudW1iZXIgPSAwLFxuICBleHBpcmVkVW5pdDogRXhwaXJlZFVuaXQgPSAndCcsXG4pOiAodGFyZ2V0OiB7fSwgcHJvcGVydHlOYW1lOiBzdHJpbmcpID0+IHZvaWQge1xuICByZXR1cm4gV2ViU3RvcmFnZShcbiAgICBpc0Jyb3dzZXIgPyBzZXNzaW9uU3RvcmFnZSA6IG51bGwsXG4gICAga2V5LFxuICAgIGV4cGlyZWRBdCxcbiAgICBleHBpcmVkVW5pdCxcbiAgKTtcbn1cbiJdfQ==