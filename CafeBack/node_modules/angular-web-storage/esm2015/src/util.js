/**
 * 判断是否在浏览器中渲染Angular应用
 * `decorator` 无法直接使用Angular `PLATFORM_ID` 标识
 * 这带来的好处是当服务端自行填充 Document 时也能很好的识别
 */
export const isBrowser = typeof document === 'object' && !!document;
export class StorageUtil {
    static get(storage, key) {
        if (storage == null) {
            return null;
        }
        const value = StorageUtil.parse(storage.getItem(key) || 'null') || null;
        if (value === null) {
            return null;
        }
        if (typeof value === 'object' &&
            typeof value._expired !== 'undefined' &&
            value._expired !== 0 &&
            +new Date() > value._expired) {
            StorageUtil.remove(storage, key);
            return null;
        }
        return value._value || null;
    }
    static set(storage, key, value, expiredAt = 0, expiredUnit = 't') {
        if (storage == null) {
            return;
        }
        storage.setItem(key, StorageUtil.stringify({
            _expired: StorageUtil.getExpired(expiredAt, expiredUnit),
            _value: value,
        }));
    }
    static remove(storage, key) {
        if (storage == null) {
            return;
        }
        storage.removeItem(key);
    }
    static key(storage, index) {
        if (storage == null) {
            return;
        }
        return storage.key(index);
    }
    static getExpired(val, unit) {
        if (val <= 0) {
            return 0;
        }
        const now = +new Date();
        switch (unit) {
            case 's': // 秒
                return now + 1000 * val;
            case 'm': // 分
                return now + 1000 * 60 * val;
            case 'h': // 时
                return now + 1000 * 60 * 60 * val;
            case 'd': // 天
                return now + 1000 * 60 * 60 * 24 * val;
            case 'w': // 周
                return now + 1000 * 60 * 60 * 24 * 7 * val;
            case 'y': // 年
                return now + 1000 * 60 * 60 * 24 * 365 * val;
            case 't': // 自定义
                return now + val;
        }
        return 0;
    }
    static stringify(value) {
        return JSON.stringify(value);
    }
    static parse(text) {
        try {
            return JSON.parse(text) || null;
        }
        catch (e) {
            return text;
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2xpYi9zcmMvdXRpbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFZQTs7OztHQUlHO0FBQ0gsTUFBTSxDQUFDLE1BQU0sU0FBUyxHQUFHLE9BQU8sUUFBUSxLQUFLLFFBQVEsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDO0FBRXBFLE1BQU0sT0FBTyxXQUFXO0lBQ3RCLE1BQU0sQ0FBQyxHQUFHLENBQUMsT0FBdUIsRUFBRSxHQUFXO1FBQzdDLElBQUksT0FBTyxJQUFJLElBQUksRUFBRTtZQUNuQixPQUFPLElBQUksQ0FBQztTQUNiO1FBQ0QsTUFBTSxLQUFLLEdBQUcsV0FBVyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLE1BQU0sQ0FBQyxJQUFJLElBQUksQ0FBQztRQUN4RSxJQUFJLEtBQUssS0FBSyxJQUFJLEVBQUU7WUFDbEIsT0FBTyxJQUFJLENBQUM7U0FDYjtRQUNELElBQ0UsT0FBTyxLQUFLLEtBQUssUUFBUTtZQUN6QixPQUFPLEtBQUssQ0FBQyxRQUFRLEtBQUssV0FBVztZQUNyQyxLQUFLLENBQUMsUUFBUSxLQUFLLENBQUM7WUFDcEIsQ0FBQyxJQUFJLElBQUksRUFBRSxHQUFHLEtBQUssQ0FBQyxRQUFRLEVBQzVCO1lBQ0EsV0FBVyxDQUFDLE1BQU0sQ0FBQyxPQUFPLEVBQUUsR0FBRyxDQUFDLENBQUM7WUFDakMsT0FBTyxJQUFJLENBQUM7U0FDYjtRQUVELE9BQU8sS0FBSyxDQUFDLE1BQU0sSUFBSSxJQUFJLENBQUM7SUFDOUIsQ0FBQztJQUVELE1BQU0sQ0FBQyxHQUFHLENBQ1IsT0FBdUIsRUFDdkIsR0FBVyxFQUNYLEtBQVUsRUFDVixZQUFvQixDQUFDLEVBQ3JCLGNBQTJCLEdBQUc7UUFFOUIsSUFBSSxPQUFPLElBQUksSUFBSSxFQUFFO1lBQ25CLE9BQU87U0FDUjtRQUNELE9BQU8sQ0FBQyxPQUFPLENBQ2IsR0FBRyxFQUNILFdBQVcsQ0FBQyxTQUFTLENBQUM7WUFDcEIsUUFBUSxFQUFFLFdBQVcsQ0FBQyxVQUFVLENBQUMsU0FBUyxFQUFFLFdBQVcsQ0FBQztZQUN4RCxNQUFNLEVBQUUsS0FBSztTQUNkLENBQUMsQ0FDSCxDQUFDO0lBQ0osQ0FBQztJQUVELE1BQU0sQ0FBQyxNQUFNLENBQUMsT0FBdUIsRUFBRSxHQUFXO1FBQ2hELElBQUksT0FBTyxJQUFJLElBQUksRUFBRTtZQUNuQixPQUFPO1NBQ1I7UUFDRCxPQUFPLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQzFCLENBQUM7SUFFRCxNQUFNLENBQUMsR0FBRyxDQUFDLE9BQXVCLEVBQUUsS0FBYTtRQUMvQyxJQUFJLE9BQU8sSUFBSSxJQUFJLEVBQUU7WUFDbkIsT0FBTztTQUNSO1FBQ0QsT0FBTyxPQUFPLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQzVCLENBQUM7SUFFTyxNQUFNLENBQUMsVUFBVSxDQUFDLEdBQVcsRUFBRSxJQUFpQjtRQUN0RCxJQUFJLEdBQUcsSUFBSSxDQUFDLEVBQUU7WUFDWixPQUFPLENBQUMsQ0FBQztTQUNWO1FBQ0QsTUFBTSxHQUFHLEdBQUcsQ0FBQyxJQUFJLElBQUksRUFBRSxDQUFDO1FBQ3hCLFFBQVEsSUFBSSxFQUFFO1lBQ1osS0FBSyxHQUFHLEVBQUUsSUFBSTtnQkFDWixPQUFPLEdBQUcsR0FBRyxJQUFJLEdBQUcsR0FBRyxDQUFDO1lBQzFCLEtBQUssR0FBRyxFQUFFLElBQUk7Z0JBQ1osT0FBTyxHQUFHLEdBQUcsSUFBSSxHQUFHLEVBQUUsR0FBRyxHQUFHLENBQUM7WUFDL0IsS0FBSyxHQUFHLEVBQUUsSUFBSTtnQkFDWixPQUFPLEdBQUcsR0FBRyxJQUFJLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxHQUFHLENBQUM7WUFDcEMsS0FBSyxHQUFHLEVBQUUsSUFBSTtnQkFDWixPQUFPLEdBQUcsR0FBRyxJQUFJLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsR0FBRyxDQUFDO1lBQ3pDLEtBQUssR0FBRyxFQUFFLElBQUk7Z0JBQ1osT0FBTyxHQUFHLEdBQUcsSUFBSSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUMsR0FBRyxHQUFHLENBQUM7WUFDN0MsS0FBSyxHQUFHLEVBQUUsSUFBSTtnQkFDWixPQUFPLEdBQUcsR0FBRyxJQUFJLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsR0FBRyxHQUFHLEdBQUcsQ0FBQztZQUMvQyxLQUFLLEdBQUcsRUFBRSxNQUFNO2dCQUNkLE9BQU8sR0FBRyxHQUFHLEdBQUcsQ0FBQztTQUNwQjtRQUNELE9BQU8sQ0FBQyxDQUFDO0lBQ1gsQ0FBQztJQUVPLE1BQU0sQ0FBQyxTQUFTLENBQUMsS0FBVTtRQUNqQyxPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDL0IsQ0FBQztJQUVPLE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBWTtRQUMvQixJQUFJO1lBQ0YsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLElBQUksQ0FBQztTQUNqQztRQUFDLE9BQU8sQ0FBQyxFQUFFO1lBQ1YsT0FBTyxJQUFJLENBQUM7U0FDYjtJQUNILENBQUM7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogRXhwaXJhdGlvbiB0aW1lIHVuaXRcbiAqIHM6IHNlY29uZHNcbiAqIG06IG1pbnV0ZVxuICogaDogaG91clxuICogZDogZGF5XG4gKiB3OiB3ZWVrXG4gKiB5OiB5ZWFyXG4gKiB0OiBDdXN0b20gKG1pbGxpc2Vjb25kKVxuICovXG5leHBvcnQgdHlwZSBFeHBpcmVkVW5pdCA9ICdzJyB8ICdtJyB8ICdoJyB8ICdkJyB8ICd3JyB8ICd5JyB8ICd0JztcblxuLyoqXG4gKiDliKTmlq3mmK/lkKblnKjmtY/op4jlmajkuK3muLLmn5NBbmd1bGFy5bqU55SoXG4gKiBgZGVjb3JhdG9yYCDml6Dms5Xnm7TmjqXkvb/nlKhBbmd1bGFyIGBQTEFURk9STV9JRGAg5qCH6K+GXG4gKiDov5nluKbmnaXnmoTlpb3lpITmmK/lvZPmnI3liqHnq6/oh6rooYzloavlhYUgRG9jdW1lbnQg5pe25Lmf6IO95b6I5aW955qE6K+G5YirXG4gKi9cbmV4cG9ydCBjb25zdCBpc0Jyb3dzZXIgPSB0eXBlb2YgZG9jdW1lbnQgPT09ICdvYmplY3QnICYmICEhZG9jdW1lbnQ7XG5cbmV4cG9ydCBjbGFzcyBTdG9yYWdlVXRpbCB7XG4gIHN0YXRpYyBnZXQoc3RvcmFnZTogU3RvcmFnZSB8IG51bGwsIGtleTogc3RyaW5nKTogYW55IHtcbiAgICBpZiAoc3RvcmFnZSA9PSBudWxsKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3QgdmFsdWUgPSBTdG9yYWdlVXRpbC5wYXJzZShzdG9yYWdlLmdldEl0ZW0oa2V5KSB8fCAnbnVsbCcpIHx8IG51bGw7XG4gICAgaWYgKHZhbHVlID09PSBudWxsKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgaWYgKFxuICAgICAgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJlxuICAgICAgdHlwZW9mIHZhbHVlLl9leHBpcmVkICE9PSAndW5kZWZpbmVkJyAmJlxuICAgICAgdmFsdWUuX2V4cGlyZWQgIT09IDAgJiZcbiAgICAgICtuZXcgRGF0ZSgpID4gdmFsdWUuX2V4cGlyZWRcbiAgICApIHtcbiAgICAgIFN0b3JhZ2VVdGlsLnJlbW92ZShzdG9yYWdlLCBrZXkpO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgcmV0dXJuIHZhbHVlLl92YWx1ZSB8fCBudWxsO1xuICB9XG5cbiAgc3RhdGljIHNldChcbiAgICBzdG9yYWdlOiBTdG9yYWdlIHwgbnVsbCxcbiAgICBrZXk6IHN0cmluZyxcbiAgICB2YWx1ZTogYW55LFxuICAgIGV4cGlyZWRBdDogbnVtYmVyID0gMCxcbiAgICBleHBpcmVkVW5pdDogRXhwaXJlZFVuaXQgPSAndCcsXG4gICk6IHZvaWQge1xuICAgIGlmIChzdG9yYWdlID09IG51bGwpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgc3RvcmFnZS5zZXRJdGVtKFxuICAgICAga2V5LFxuICAgICAgU3RvcmFnZVV0aWwuc3RyaW5naWZ5KHtcbiAgICAgICAgX2V4cGlyZWQ6IFN0b3JhZ2VVdGlsLmdldEV4cGlyZWQoZXhwaXJlZEF0LCBleHBpcmVkVW5pdCksXG4gICAgICAgIF92YWx1ZTogdmFsdWUsXG4gICAgICB9KSxcbiAgICApO1xuICB9XG5cbiAgc3RhdGljIHJlbW92ZShzdG9yYWdlOiBTdG9yYWdlIHwgbnVsbCwga2V5OiBzdHJpbmcpOiB2b2lkIHtcbiAgICBpZiAoc3RvcmFnZSA9PSBudWxsKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHN0b3JhZ2UucmVtb3ZlSXRlbShrZXkpO1xuICB9XG5cbiAgc3RhdGljIGtleShzdG9yYWdlOiBTdG9yYWdlIHwgbnVsbCwgaW5kZXg6IG51bWJlcik6IHN0cmluZyB7XG4gICAgaWYgKHN0b3JhZ2UgPT0gbnVsbCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICByZXR1cm4gc3RvcmFnZS5rZXkoaW5kZXgpO1xuICB9XG5cbiAgcHJpdmF0ZSBzdGF0aWMgZ2V0RXhwaXJlZCh2YWw6IG51bWJlciwgdW5pdDogRXhwaXJlZFVuaXQpOiBudW1iZXIge1xuICAgIGlmICh2YWwgPD0gMCkge1xuICAgICAgcmV0dXJuIDA7XG4gICAgfVxuICAgIGNvbnN0IG5vdyA9ICtuZXcgRGF0ZSgpO1xuICAgIHN3aXRjaCAodW5pdCkge1xuICAgICAgY2FzZSAncyc6IC8vIOenklxuICAgICAgICByZXR1cm4gbm93ICsgMTAwMCAqIHZhbDtcbiAgICAgIGNhc2UgJ20nOiAvLyDliIZcbiAgICAgICAgcmV0dXJuIG5vdyArIDEwMDAgKiA2MCAqIHZhbDtcbiAgICAgIGNhc2UgJ2gnOiAvLyDml7ZcbiAgICAgICAgcmV0dXJuIG5vdyArIDEwMDAgKiA2MCAqIDYwICogdmFsO1xuICAgICAgY2FzZSAnZCc6IC8vIOWkqVxuICAgICAgICByZXR1cm4gbm93ICsgMTAwMCAqIDYwICogNjAgKiAyNCAqIHZhbDtcbiAgICAgIGNhc2UgJ3cnOiAvLyDlkahcbiAgICAgICAgcmV0dXJuIG5vdyArIDEwMDAgKiA2MCAqIDYwICogMjQgKiA3ICogdmFsO1xuICAgICAgY2FzZSAneSc6IC8vIOW5tFxuICAgICAgICByZXR1cm4gbm93ICsgMTAwMCAqIDYwICogNjAgKiAyNCAqIDM2NSAqIHZhbDtcbiAgICAgIGNhc2UgJ3QnOiAvLyDoh6rlrprkuYlcbiAgICAgICAgcmV0dXJuIG5vdyArIHZhbDtcbiAgICB9XG4gICAgcmV0dXJuIDA7XG4gIH1cblxuICBwcml2YXRlIHN0YXRpYyBzdHJpbmdpZnkodmFsdWU6IGFueSk6IHN0cmluZyB7XG4gICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHZhbHVlKTtcbiAgfVxuXG4gIHByaXZhdGUgc3RhdGljIHBhcnNlKHRleHQ6IHN0cmluZyk6IGFueSB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBKU09OLnBhcnNlKHRleHQpIHx8IG51bGw7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgcmV0dXJuIHRleHQ7XG4gICAgfVxuICB9XG59XG4iXX0=